<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Cricket Live Score</title>
    
    <!-- 1. STYLING & ICONS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 2. FIREBASE SDK (The Magic for Real-Time) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: #f0f2f5; }
        .cb-header { background: linear-gradient(to right, #009270, #007a5e); }
        .live-dot { height: 10px; width: 10px; background-color: #ef4444; border-radius: 50%; display: inline-block; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        .ball-circle { width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; font-size: 0.8rem; }
        .bg-4 { background: #3b82f6; color: white; }
        .bg-6 { background: #8b5cf6; color: white; }
        .bg-w { background: #ef4444; color: white; }
        .bg-n { background: #e5e7eb; color: #374151; }
    </style>
</head>
<body class="text-slate-800">

    <!-- HEADER -->
    <header class="cb-header text-white shadow-md sticky top-0 z-50">
        <div class="max-w-md mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-cricket text-xl"></i>
                <h1 class="text-lg font-bold">CricLive</h1>
            </div>
            <div class="flex items-center space-x-3">
                <div class="flex items-center bg-white/20 px-2 py-1 rounded text-xs font-bold uppercase tracking-wider">
                    <span class="live-dot mr-1"></span> LIVE
                </div>
                <button onclick="toggleAdminLogin()" class="text-white hover:text-green-200">
                    <i class="fas fa-lock"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto pb-24">
        
        <!-- SCORECARD MAIN -->
        <div class="bg-white shadow-sm mb-2">
            <div class="px-4 py-4 border-b border-gray-100">
                <h2 class="text-xs font-bold text-gray-500 uppercase" id="matchTitle">Loading Match...</h2>
                <div class="mt-2 flex justify-between items-end">
                    <div>
                        <div class="text-4xl font-bold text-gray-800 leading-none">
                            <span id="score">0</span>/<span id="wickets">0</span>
                        </div>
                        <div class="text-sm text-gray-500 mt-2">
                            Over <span id="overs">0.0</span> <span class="mx-1">â€¢</span> CRR: <span id="crr">0.00</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-bold text-red-600" id="battingTeam">...</div>
                        <div class="text-xs text-gray-400 mt-1">Target: <span id="target">--</span></div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Balls -->
            <div class="px-4 py-3 bg-gray-50 flex items-center space-x-3 overflow-x-auto whitespace-nowrap scrollbar-hide">
                <span class="text-xs font-bold text-gray-500">LAST 12:</span>
                <div id="recentBalls" class="flex space-x-2">
                    <!-- Balls injected here by JS -->
                </div>
            </div>
        </div>

        <!-- BATSMEN -->
        <div class="bg-white shadow-sm mb-2">
            <div class="px-4 py-2 bg-gray-100 border-b flex justify-between text-xs font-bold text-gray-600">
                <span>BATTER</span>
                <div class="flex space-x-4 pr-1">
                    <span class="w-6 text-center">R</span>
                    <span class="w-6 text-center">B</span>
                    <span class="w-6 text-center">4s</span>
                    <span class="w-6 text-center">6s</span>
                </div>
            </div>
            <div id="batsmanList">
                <!-- Batsman 1 -->
                <div class="px-4 py-3 border-b flex justify-between items-center bg-green-50">
                    <div class="font-semibold text-sm">
                        <span id="p1Name">Striker</span> <span class="text-green-600">*</span>
                    </div>
                    <div class="flex space-x-4 text-sm pr-1">
                        <span class="w-6 text-center font-bold" id="p1Runs">0</span>
                        <span class="w-6 text-center text-gray-500" id="p1Balls">0</span>
                        <span class="w-6 text-center text-gray-400" id="p14s">0</span>
                        <span class="w-6 text-center text-gray-400" id="p16s">0</span>
                    </div>
                </div>
                <!-- Batsman 2 -->
                <div class="px-4 py-3 border-b flex justify-between items-center">
                    <div class="font-semibold text-sm text-gray-600" id="p2Name">Non-Striker</div>
                    <div class="flex space-x-4 text-sm pr-1">
                        <span class="w-6 text-center font-bold" id="p2Runs">0</span>
                        <span class="w-6 text-center text-gray-500" id="p2Balls">0</span>
                        <span class="w-6 text-center text-gray-400" id="p24s">0</span>
                        <span class="w-6 text-center text-gray-400" id="p26s">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOWLER -->
        <div class="bg-white shadow-sm mb-2">
            <div class="px-4 py-2 bg-gray-100 border-b flex justify-between text-xs font-bold text-gray-600">
                <span>BOWLER</span>
                <div class="flex space-x-4 pr-1">
                    <span class="w-6 text-center">O</span>
                    <span class="w-6 text-center">M</span>
                    <span class="w-6 text-center">R</span>
                    <span class="w-6 text-center">W</span>
                </div>
            </div>
            <div class="px-4 py-3 border-b flex justify-between items-center">
                <div class="font-semibold text-sm" id="bName">Bowler</div>
                <div class="flex space-x-4 text-sm pr-1">
                    <span class="w-6 text-center text-gray-600" id="bOvers">0.0</span>
                    <span class="w-6 text-center text-gray-400" id="bMaiden">0</span>
                    <span class="w-6 text-center text-gray-600" id="bRuns">0</span>
                    <span class="w-6 text-center font-bold text-red-500" id="bWickets">0</span>
                </div>
            </div>
        </div>

        <!-- COMMENTARY -->
        <div class="bg-white shadow-sm">
            <div class="px-4 py-2 bg-gray-100 border-b text-xs font-bold text-gray-600">COMMENTARY</div>
            <div id="commentaryBox" class="max-h-60 overflow-y-auto">
                <div class="p-4 text-center text-gray-400 text-sm">Waiting for updates...</div>
            </div>
        </div>

    </main>

    <!-- ADMIN MODAL -->
    <div id="adminModal" class="fixed inset-0 bg-black/90 z-[60] hidden flex items-center justify-center p-4">
        
        <!-- LOGIN CARD -->
        <div id="loginCard" class="bg-white w-full max-w-sm rounded-xl p-6 shadow-2xl">
            <h2 class="text-xl font-bold mb-4">Admin Access</h2>
            <input type="password" id="adminPass" placeholder="Enter Admin Password" class="w-full border p-3 rounded mb-4 focus:outline-none focus:ring-2 focus:ring-green-500">
            <button onclick="verifyAdmin()" class="w-full bg-green-600 text-white font-bold py-3 rounded hover:bg-green-700">LOGIN</button>
            <button onclick="toggleAdminLogin()" class="w-full mt-3 text-gray-500 text-sm">Cancel</button>
        </div>

        <!-- CONTROL PANEL (Shown after login) -->
        <div id="controlPanel" class="bg-white w-full max-w-md rounded-xl shadow-2xl hidden flex flex-col h-[90vh]">
            <div class="p-4 bg-gray-800 text-white flex justify-between items-center rounded-t-xl">
                <h2 class="font-bold">Scoring Console</h2>
                <button onclick="toggleAdminLogin()" class="text-sm bg-gray-700 px-3 py-1 rounded">Close</button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4">
                <!-- Status -->
                <div class="text-center mb-4">
                    <span class="text-xs text-gray-500">Current Score</span>
                    <div class="text-2xl font-bold"><span id="ctrlScore">0</span>/<span id="ctrlWick">0</span> (<span id="ctrlOver">0.0</span>)</div>
                </div>

                <!-- Main Buttons -->
                <div class="grid grid-cols-4 gap-2 mb-4">
                    <button onclick="updateScore(0)" class="p-4 bg-gray-100 rounded font-bold hover:bg-gray-200">0</button>
                    <button onclick="updateScore(1)" class="p-4 bg-gray-100 rounded font-bold hover:bg-gray-200">1</button>
                    <button onclick="updateScore(2)" class="p-4 bg-gray-100 rounded font-bold hover:bg-gray-200">2</button>
                    <button onclick="updateScore(3)" class="p-4 bg-gray-100 rounded font-bold hover:bg-gray-200">3</button>
                    <button onclick="updateScore(4)" class="p-4 bg-blue-100 text-blue-700 rounded font-bold border border-blue-200">4</button>
                    <button onclick="updateScore(6)" class="p-4 bg-purple-100 text-purple-700 rounded font-bold border border-purple-200">6</button>
                    <button onclick="updateExtra('WD')" class="p-4 bg-yellow-100 text-yellow-700 rounded font-bold text-sm">WD</button>
                    <button onclick="updateExtra('NB')" class="p-4 bg-orange-100 text-orange-700 rounded font-bold text-sm">NB</button>
                </div>

                <div class="grid grid-cols-2 gap-2 mb-6">
                    <button onclick="updateWicket()" class="p-3 bg-red-600 text-white rounded font-bold">OUT (Wicket)</button>
                    <button onclick="rotateStrike()" class="p-3 bg-indigo-600 text-white rounded font-bold">Rotate Strike</button>
                </div>

                <!-- Edits -->
                <div class="space-y-3 border-t pt-4">
                    <h3 class="text-sm font-bold text-gray-500">Update Names</h3>
                    <input id="newP1" type="text" placeholder="Striker Name" class="w-full border p-2 rounded text-sm">
                    <input id="newP2" type="text" placeholder="Non-Striker Name" class="w-full border p-2 rounded text-sm">
                    <input id="newBowler" type="text" placeholder="Bowler Name" class="w-full border p-2 rounded text-sm">
                    <button onclick="saveNames()" class="w-full bg-gray-800 text-white py-2 rounded text-sm">Update Player Names</button>
                </div>

                <div class="mt-4 pt-4 border-t">
                    <input id="customComm" type="text" placeholder="Custom Commentary (e.g. What a catch!)" class="w-full border p-2 rounded text-sm mb-2">
                    <button onclick="sendCommentary()" class="w-full bg-gray-200 text-gray-800 py-2 rounded text-sm font-bold">Post Commentary</button>
                </div>
                
                <div class="mt-8 pt-4 border-t text-center">
                    <button onclick="resetMatch()" class="text-red-500 text-xs underline">Reset All Match Data</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION SECTION
        // ==========================================
        
        // 1. Paste your Firebase Config Object below inside the braces {}
        const firebaseConfig = {
            // apiKey: "AIzaSyD1xXp7HdfIJx6zlEFAJRAPqnSqtB45T14",
            authDomain: "cricketmatch-d5189.firebaseapp.com",
            projectId: "cricketmatch-d5189",
            storageBucket: "cricketmatch-d5189.firebasestorage.app",
            messagingSenderId: "853349010179",
            appId: "1:853349010179:web:0172a8e20eea613924f736",
            measurementId: "G-VQ169V2XMM"
            // Example:
            // apiKey: "AIzaSyD...",
            // authDomain: "project.firebaseapp.com",
            // projectId: "project-id",
            // storageBucket: "project.appspot.com",
            // messagingSenderId: "123...",
            // appId: "1:123..."
        };

        const ADMIN_PASSWORD = "Pinku@31"; // Your requested password

        // ==========================================
        // APP LOGIC
        // ==========================================
        
        // Initialize Firebase
        if (firebaseConfig.projectId) {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const matchRef = db.collection('cricket_matches').doc('live_match_001');

            // --- LISTEN FOR UPDATES (Real-time for everyone) ---
            matchRef.onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    renderUI(data);
                } else {
                    // Initialize if empty
                    console.log("No match found. Waiting for Admin to start...");
                    document.getElementById('matchTitle').innerText = "Match Not Started";
                }
            });

            // --- GLOBAL STATE FOR ADMIN ---
            let currentState = null;

            function renderUI(data) {
                currentState = data; // Store for admin use
                
                // Header
                document.getElementById('matchTitle').innerText = data.title || "College Match";
                document.getElementById('battingTeam').innerText = data.battingTeam || "Team A";
                document.getElementById('target').innerText = data.target || "---";

                // Main Score
                document.getElementById('score').innerText = data.score || 0;
                document.getElementById('wickets').innerText = data.wickets || 0;
                
                // Overs
                const balls = data.balls || 0;
                const overs = Math.floor(balls / 6);
                const remBalls = balls % 6;
                document.getElementById('overs').innerText = `${overs}.${remBalls}`;
                
                // CRR
                const crr = balls > 0 ? (data.score / (balls/6)).toFixed(2) : "0.00";
                document.getElementById('crr').innerText = crr;

                // Players
                updatePlayerUI('p1', data.striker);
                updatePlayerUI('p2', data.nonStriker);
                updateBowlerUI(data.bowler);

                // Recent Balls
                const ballContainer = document.getElementById('recentBalls');
                ballContainer.innerHTML = '';
                (data.recentBalls || []).slice(-12).reverse().forEach(b => {
                    let colorClass = 'bg-n';
                    if(b == '4') colorClass = 'bg-4';
                    if(b == '6') colorClass = 'bg-6';
                    if(b == 'W') colorClass = 'bg-w';
                    ballContainer.innerHTML += `<span class="ball-circle ${colorClass} flex-shrink-0 text-white text-xs">${b}</span>`;
                });

                // Commentary
                const commBox = document.getElementById('commentaryBox');
                commBox.innerHTML = '';
                (data.commentary || []).slice(0, 15).forEach(c => {
                    commBox.innerHTML += `
                        <div class="px-4 py-2 border-b border-gray-50 text-sm flex space-x-2">
                            <span class="font-bold text-gray-800">${c.over}</span>
                            <span class="text-gray-600">${c.text}</span>
                        </div>`;
                });

                // Update Admin Monitor
                if(document.getElementById('controlPanel').classList.contains('flex')) {
                    document.getElementById('ctrlScore').innerText = data.score;
                    document.getElementById('ctrlWick').innerText = data.wickets;
                    document.getElementById('ctrlOver').innerText = `${overs}.${remBalls}`;
                    // Sync inputs
                    document.getElementById('newP1').value = data.striker.name;
                    document.getElementById('newP2').value = data.nonStriker.name;
                    document.getElementById('newBowler').value = data.bowler.name;
                }
            }

            function updatePlayerUI(id, p) {
                if(!p) return;
                document.getElementById(id+'Name').innerText = p.name;
                document.getElementById(id+'Runs').innerText = p.runs;
                document.getElementById(id+'Balls').innerText = p.balls;
                document.getElementById(id+'4s').innerText = p.fours;
                document.getElementById(id+'6s').innerText = p.sixes;
            }

            function updateBowlerUI(b) {
                if(!b) return;
                document.getElementById('bName').innerText = b.name;
                document.getElementById('bRuns').innerText = b.runs;
                document.getElementById('bWickets').innerText = b.wickets;
                const o = Math.floor(b.balls / 6);
                const r = b.balls % 6;
                document.getElementById('bOvers').innerText = `${o}.${r}`;
                document.getElementById('bMaiden').innerText = b.maidens;
            }

            // --- ADMIN ACTIONS ---
            window.updateScore = function(run) {
                if (!currentState) return;
                
                let s = currentState;
                s.score += run;
                s.balls += 1; // Legal ball
                s.striker.runs += run;
                s.striker.balls += 1;
                if(run == 4) s.striker.fours++;
                if(run == 6) s.striker.sixes++;
                
                s.bowler.runs += run;
                s.bowler.balls += 1;
                
                s.recentBalls.push(run);
                
                // Add commentary
                const overTxt = getOverStr(s.balls);
                s.commentary.unshift({ over: overTxt, text: `${s.striker.name} scores ${run} run(s).` });
                
                // Auto Rotate
                if(run % 2 !== 0) {
                    let temp = s.striker;
                    s.striker = s.nonStriker;
                    s.nonStriker = temp;
                }

                checkOver(s);
                saveToCloud(s);
            };

            window.updateExtra = function(type) {
                let s = currentState;
                s.score += 1;
                s.bowler.runs += 1;
                s.recentBalls.push(type);
                
                const overTxt = getOverStr(s.balls);
                s.commentary.unshift({ over: overTxt, text: `${type} bowled.` });
                saveToCloud(s);
            };

            window.updateWicket = function() {
                let s = currentState;
                s.wickets += 1;
                s.balls += 1;
                s.striker.balls += 1; // Ball faced
                s.bowler.balls += 1;
                s.bowler.wickets += 1;
                s.recentBalls.push('W');
                
                const overTxt = getOverStr(s.balls);
                s.commentary.unshift({ over: overTxt, text: `WICKET! ${s.striker.name} is out.` });
                
                s.striker = { name: "New Batter", runs: 0, balls: 0, fours: 0, sixes: 0 };
                
                checkOver(s);
                saveToCloud(s);
            };

            window.rotateStrike = function() {
                let s = currentState;
  